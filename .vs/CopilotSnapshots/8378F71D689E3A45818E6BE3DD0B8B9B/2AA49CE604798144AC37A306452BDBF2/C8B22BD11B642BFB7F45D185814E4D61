using System.Data;
using ExcelReader.RyanW84.Abstractions.Core;

namespace ExcelReader.RyanW84.Services;

/// <summary>
/// Converts CSV data (List of string arrays) to DataTable
/// </summary>
public class CsvToDataTableConverter : IDataConverter<List<string[]>, DataTable>
{
    public DataTable Convert(List<string[]> csvData)
    {
        var dataTable = new DataTable();

        if (csvData == null || csvData.Count == 0)
            return dataTable;

        // Add columns using the first row as header
        foreach (var columnName in csvData[0])
        {
            dataTable.Columns.Add(columnName ?? string.Empty);
        }

        // Add rows (skip header row)
        for (int i = 1; i < csvData.Count; i++)
        {
            dataTable.Rows.Add(csvData[i]);
        }

        return dataTable;
    }

    public async Task<DataTable> ConvertAsync(List<string[]> csvData)
    {
        return await Task.Run(() => Convert(csvData));
    }
}