using System.Data;
using ExcelReader.RyanW84.Models;

namespace ExcelReader.RyanW84.Abstractions;

/// <summary>
/// Interface for file reading operations - follows Interface Segregation Principle
/// </summary>
/// <typeparam name="T">The type of data to read</typeparam>
public interface IFileReader<T>
{
    /// <summary>
    /// Reads data from a file asynchronously
    /// </summary>
    /// <param name="filePath">Path to the file to read</param>
    /// <returns>Data read from the file</returns>
    Task<T> ReadAsync(string filePath);
    
    /// <summary>
    /// Validates if the file can be read
    /// </summary>
    /// <param name="filePath">Path to the file to validate</param>
    /// <returns>True if file can be read, false otherwise</returns>
    bool CanRead(string filePath);
}

/// <summary>
/// Interface for Excel file reading operations
/// </summary>
public interface IExcelReader : IFileReader<DataTable>
{
    /// <summary>
    /// Gets available worksheet names in the Excel file
    /// </summary>
    /// <param name="filePath">Path to the Excel file</param>
    /// <returns>List of worksheet names</returns>
    Task<IEnumerable<string>> GetWorksheetsAsync(string filePath);
}

/// <summary>
/// Interface for PDF file reading operations
/// </summary>
public interface IPdfReader : IFileReader<Dictionary<string, string>>
{
    /// <summary>
    /// Reads form fields from PDF
    /// </summary>
    /// <param name="filePath">Path to the PDF file</param>
    /// <returns>Dictionary of form field names and values</returns>
    Task<Dictionary<string, string>> ReadFormFieldsAsync(string filePath);
}

/// <summary>
/// Interface for CSV file reading operations
/// </summary>
public interface ICsvReader : IFileReader<DataTable>
{
    /// <summary>
    /// Gets the number of columns in the CSV file
    /// </summary>
    /// <param name="filePath">Path to the CSV file</param>
    /// <returns>Number of columns</returns>
    Task<int> GetColumnCountAsync(string filePath);
}

/// <summary>
/// Generic repository interface following Repository pattern and Dependency Inversion Principle
/// </summary>
/// <typeparam name="T">Entity type</typeparam>
public interface IRepository<T> where T : class
{
    Task<IEnumerable<T>> GetAllAsync();
    Task<T?> GetByIdAsync(int id);
    Task<T> AddAsync(T entity);
    Task<IEnumerable<T>> AddRangeAsync(IEnumerable<T> entities);
    Task<T> UpdateAsync(T entity);
    Task DeleteAsync(int id);
    Task<bool> ExistsAsync(int id);
    Task<int> SaveChangesAsync();
}

/// <summary>
/// Specific repository interface for ExcelBeginner entities
/// </summary>
public interface IExcelBeginnerRepository : IRepository<ExcelBeginner>
{
    Task<IEnumerable<ExcelBeginner>> GetByNameAsync(string name);
    Task<IEnumerable<ExcelBeginner>> GetByAgeRangeAsync(int minAge, int maxAge);
}

/// <summary>
/// Interface for database table operations
/// </summary>
public interface ITableManager
{
    Task EnsureTableExistsAsync(DataTable dataTable);
    Task<bool> TableExistsAsync(string tableName);
    Task CreateTableAsync(string tableName, DataTable structure);
    Task DropTableAsync(string tableName);
}

/// <summary>
/// Interface for data conversion operations
/// </summary>
public interface IDataConverter<TSource, TTarget>
{
    TTarget Convert(TSource source);
    Task<TTarget> ConvertAsync(TSource source);
}

/// <summary>
/// Interface for notification services
/// </summary>
public interface INotificationService
{
    void ShowSuccess(string message);
    void ShowError(string message);
    void ShowWarning(string message);
    void ShowInfo(string message);
}

/// <summary>
/// Interface for file path management
/// </summary>
public interface IFilePathService
{
    string GetFilePath(FileType fileType, string? customDefault = null);
    void ValidateFilePath(string filePath, FileType fileType);
    bool IsValidPath(string filePath);
}

/// <summary>
/// Enum for file types
/// </summary>
public enum FileType
{
    Excel,
    PDF,
    CSV,
    Generic
}